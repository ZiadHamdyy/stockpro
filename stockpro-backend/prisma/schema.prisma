generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String
  name                  String?
  password              String?
  emailVerified         Boolean                @default(true)
  active                Boolean                @default(true)
  roleId                String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  branchId              String
  companyId             String
  image                 Bytes?
  code                  Int
  internalTransfers     InternalTransfer[]
  inventoryCounts       InventoryCount[]
  Otp                   Otp[]
  paymentVouchers       PaymentVoucher[]
  priceQuotations       PriceQuotation[]
  purchaseInvoices      PurchaseInvoice[]
  purchaseReturns       PurchaseReturn[]
  receiptVouchers       ReceiptVoucher[]
  salesInvoices         SalesInvoice[]
  salesReturns          SalesReturn[]
  Session               Session[]
  Store                 Store[]
  storeIssueVouchers    StoreIssueVoucher[]
  storeReceiptVouchers  StoreReceiptVoucher[]
  storeTransferVouchers StoreTransferVoucher[]
  auditLogs             AuditLog[]
  notifications         Notification[]
  branch                Branch                 @relation(fields: [branchId], references: [id])
  role                  Role?                  @relation(fields: [roleId], references: [id])
  company               Company                @relation(fields: [companyId], references: [id])

  @@unique([email, companyId])
  @@unique([code, companyId])
  @@index([companyId])
  @@index([companyId, code])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Session {
  id           String        @id @default(uuid())
  status       SessionStatus @default(ACTIVE)
  refreshToken String?
  ipAddress    String?
  userAgent    String?
  userId       String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  user         User          @relation(fields: [userId], references: [id])
}

model Otp {
  id           String   @id @default(uuid())
  otpHash      String
  otpExpiresAt DateTime
  otpVerified  Boolean  @default(false)
  type         OtpType
  userId       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([otpExpiresAt])
}

model Role {
  id                 String           @id @default(uuid())
  name               String
  description        String?
  isSystem           Boolean          @default(false)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  permissionsVersion Int              @default(0)
  companyId          String
  rolePermissions    RolePermission[]
  users              User[]
  company            Company          @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Permission {
  id              String           @id @default(uuid())
  resource        String
  action          String
  description     String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  companyId       String
  rolePermissions RolePermission[]
  company         Company         @relation(fields: [companyId], references: [id])

  @@unique([resource, action, companyId])
  @@index([resource])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
}

model ItemGroup {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  code        Int
  companyId   String
  items       Item[]
  company     Company  @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@unique([code, companyId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Unit {
  id          String   @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  code        Int
  companyId   String
  items       Item[]
  company     Company  @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@unique([code, companyId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Item {
  id                        String                     @id @default(uuid())
  code                      String
  barcode                   String?
  name                      String
  purchasePrice             Float
  salePrice                 Float                      @default(0)
  stock                     Float                      @default(0)
  reorderLimit              Float                      @default(0)
  groupId                   String
  unitId                    String
  companyId                 String
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  type                      ItemType                   @default(STOCKED)
  initialPurchasePrice      Float                      @default(0)
  inventoryCountItems       InventoryCountItem[]
  group                     ItemGroup                  @relation(fields: [groupId], references: [id])
  unit                      Unit                       @relation(fields: [unitId], references: [id])
  company                   Company                    @relation(fields: [companyId], references: [id])
  storeIssueVoucherItems    StoreIssueVoucherItem[]
  storeItems                StoreItem[]
  storeReceiptVoucherItems  StoreReceiptVoucherItem[]
  storeTransferVoucherItems StoreTransferVoucherItem[]

  @@unique([code, companyId])
  @@index([code])
  @@index([barcode])
  @@index([groupId])
  @@index([unitId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Company {
  id                String             @id @default(uuid())
  name              String
  activity          String
  address           String
  phone             String
  taxNumber         String
  commercialReg     String
  currency          String
  capital           Float
  vatRate           Float              @default(0)
  isVatEnabled      Boolean            @default(false)
  host              String             @unique
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  logo              Bytes?
  users             User[]
  roles             Role[]
  permissions       Permission[]
  itemGroups        ItemGroup[]
  units             Unit[]
  items             Item[]
  branches          Branch[]
  stores            Store[]
  banks             Bank[]
  safes             Safe[]
  customers         Customer[]
  suppliers         Supplier[]
  currentAccounts   CurrentAccount[]
  receivableAccounts ReceivableAccount[]
  payableAccounts   PayableAccount[]
  expenseTypes      ExpenseType[]
  expenseCodes      ExpenseCode[]
  revenueCodes      RevenueCode[]
  expenses          Expense[]
  salesInvoices     SalesInvoice[]
  salesReturns      SalesReturn[]
  purchaseInvoices  PurchaseInvoice[]
  purchaseReturns   PurchaseReturn[]
  paymentVouchers   PaymentVoucher[]
  receiptVouchers   ReceiptVoucher[]
  internalTransfers InternalTransfer[]
  priceQuotations   PriceQuotation[]
  storeReceiptVouchers StoreReceiptVoucher[]
  storeIssueVouchers StoreIssueVoucher[]
  storeTransferVouchers StoreTransferVoucher[]
  inventoryCounts   InventoryCount[]
  fiscalYears       FiscalYear[]
  auditLogs         AuditLog[]
  notifications     Notification[]
  subscription      Subscription?

  @@index([host])
}

model Bank {
  id               String             @id @default(uuid())
  code             String
  name             String
  accountNumber    String
  iban             String
  openingBalance   Float              @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  currentBalance   Float              @default(0)
  companyId        String
  fromTransfers    InternalTransfer[] @relation("FromBankTransfers")
  toTransfers      InternalTransfer[] @relation("ToBankTransfers")
  paymentVouchers  PaymentVoucher[]
  purchaseInvoices PurchaseInvoice[]
  purchaseReturns  PurchaseReturn[]
  receiptVouchers  ReceiptVoucher[]
  salesInvoices    SalesInvoice[]
  salesReturns     SalesReturn[]
  company          Company            @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Safe {
  id               String             @id @default(uuid())
  code             String
  name             String
  branchId         String             @unique
  openingBalance   Float              @default(0)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  currentBalance   Float              @default(0)
  companyId        String
  fromTransfers    InternalTransfer[] @relation("FromSafeTransfers")
  toTransfers      InternalTransfer[] @relation("ToSafeTransfers")
  paymentVouchers  PaymentVoucher[]
  purchaseInvoices PurchaseInvoice[]
  purchaseReturns  PurchaseReturn[]
  receiptVouchers  ReceiptVoucher[]
  branch           Branch             @relation(fields: [branchId], references: [id])
  company          Company           @relation(fields: [companyId], references: [id])
  salesInvoices    SalesInvoice[]
  salesReturns     SalesReturn[]

  @@unique([code, companyId])
  @@index([code])
  @@index([branchId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Customer {
  id              String           @id @default(uuid())
  code            String
  name            String
  commercialReg   String
  taxNumber       String
  nationalAddress String
  phone           String
  openingBalance  Float            @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  currentBalance  Float            @default(0)
  companyId       String
  paymentVouchers PaymentVoucher[]
  priceQuotations PriceQuotation[]
  receiptVouchers ReceiptVoucher[]
  salesInvoices   SalesInvoice[]
  salesReturns    SalesReturn[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Supplier {
  id               String            @id @default(uuid())
  code             String
  name             String
  commercialReg    String
  taxNumber        String
  nationalAddress  String
  phone            String
  openingBalance   Float             @default(0)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  currentBalance   Float             @default(0)
  companyId        String
  paymentVouchers  PaymentVoucher[]
  purchaseInvoices PurchaseInvoice[]
  purchaseReturns  PurchaseReturn[]
  receiptVouchers  ReceiptVoucher[]
  company          Company           @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Branch {
  id                String             @id @default(uuid())
  name              String
  address           String?
  phone             String?
  description       String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  code              Int
  companyId         String
  internalTransfers InternalTransfer[]
  inventoryCounts   InventoryCount[]
  paymentVouchers   PaymentVoucher[]
  priceQuotations   PriceQuotation[]
  purchaseInvoices  PurchaseInvoice[]
  purchaseReturns   PurchaseReturn[]
  receiptVouchers   ReceiptVoucher[]
  safes             Safe?
  salesInvoices     SalesInvoice[]
  salesReturns      SalesReturn[]
  stores            Store?
  users             User[]
  auditLogs         AuditLog[]
  company           Company            @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([companyId])
  @@index([companyId, code])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Store {
  id                   String                 @id @default(uuid())
  name                 String
  address              String?
  phone                String?
  description          String?
  branchId             String                 @unique
  userId                String
  companyId            String
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  code                 Int
  inventoryCounts      InventoryCount[]
  branch               Branch                 @relation(fields: [branchId], references: [id])
  user                 User                   @relation(fields: [userId], references: [id])
  company               Company                @relation(fields: [companyId], references: [id])
  storeIssueVouchers   StoreIssueVoucher[]
  storeItems           StoreItem[]
  storeReceiptVouchers StoreReceiptVoucher[]
  fromTransfers        StoreTransferVoucher[] @relation("FromStore")
  toTransfers          StoreTransferVoucher[] @relation("ToStore")

  @@unique([code, companyId])
  @@index([branchId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model StoreReceiptVoucher {
  id            String                    @id @default(uuid())
  voucherNumber String
  date          DateTime                  @default(now())
  notes         String?
  totalAmount   Float                     @default(0)
  storeId       String
  userId        String
  companyId     String
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt
  store         Store                     @relation(fields: [storeId], references: [id])
  user          User                      @relation(fields: [userId], references: [id])
  company       Company                   @relation(fields: [companyId], references: [id])
  items         StoreReceiptVoucherItem[]

  @@unique([voucherNumber, companyId])
  @@index([voucherNumber])
  @@index([date])
  @@index([storeId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model StoreIssueVoucher {
  id            String                  @id @default(uuid())
  voucherNumber String
  date          DateTime                @default(now())
  notes         String?
  totalAmount   Float                   @default(0)
  storeId       String
  userId        String
  companyId     String
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  store         Store                   @relation(fields: [storeId], references: [id])
  user          User                    @relation(fields: [userId], references: [id])
  company       Company                 @relation(fields: [companyId], references: [id])
  items         StoreIssueVoucherItem[]

  @@unique([voucherNumber, companyId])
  @@index([voucherNumber])
  @@index([date])
  @@index([storeId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model StoreTransferVoucher {
  id            String                     @id @default(uuid())
  voucherNumber String
  date          DateTime                   @default(now())
  notes         String?
  totalAmount   Float                      @default(0)
  status        StoreTransferStatus        @default(PENDING)
  fromStoreId   String
  toStoreId     String
  userId        String
  companyId     String
  createdAt     DateTime                   @default(now())
  updatedAt     DateTime                   @updatedAt
  fromStore     Store                      @relation("FromStore", fields: [fromStoreId], references: [id])
  toStore       Store                      @relation("ToStore", fields: [toStoreId], references: [id])
  user          User                       @relation(fields: [userId], references: [id])
  company       Company                    @relation(fields: [companyId], references: [id])
  items         StoreTransferVoucherItem[]
  notifications Notification[]             @relation("TransferNotifications")

  @@unique([voucherNumber, companyId])
  @@index([voucherNumber])
  @@index([date])
  @@index([fromStoreId])
  @@index([toStoreId])
  @@index([status])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model StoreReceiptVoucherItem {
  id         String              @id @default(uuid())
  quantity   Float
  unitPrice  Float
  totalPrice Float
  voucherId  String
  itemId     String
  createdAt  DateTime            @default(now())
  updatedAt  DateTime            @updatedAt
  item       Item                @relation(fields: [itemId], references: [id])
  voucher    StoreReceiptVoucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
  @@index([itemId])
}

model StoreIssueVoucherItem {
  id         String            @id @default(uuid())
  quantity   Float
  unitPrice  Float
  totalPrice Float
  voucherId  String
  itemId     String
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  item       Item              @relation(fields: [itemId], references: [id])
  voucher    StoreIssueVoucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
  @@index([itemId])
}

model StoreTransferVoucherItem {
  id         String               @id @default(uuid())
  quantity   Float
  unitPrice  Float
  totalPrice Float
  voucherId  String
  itemId     String
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  item       Item                 @relation(fields: [itemId], references: [id])
  voucher    StoreTransferVoucher @relation(fields: [voucherId], references: [id], onDelete: Cascade)

  @@index([voucherId])
  @@index([itemId])
}

model StoreItem {
  id             String   @id @default(uuid())
  openingBalance Float    @default(0)
  storeId        String
  itemId         String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  item           Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  store          Store    @relation(fields: [storeId], references: [id], onDelete: Cascade)

  @@unique([storeId, itemId])
  @@index([storeId])
  @@index([itemId])
}

model Notification {
  id                   String                @id @default(uuid())
  userId               String
  type                 String
  message              String
  relatedId            String?
  read                 Boolean               @default(false)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  companyId            String
  company              Company               @relation(fields: [companyId], references: [id])
  user                 User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  storeTransferVoucher StoreTransferVoucher? @relation("TransferNotifications", fields: [relatedId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([createdAt])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model CurrentAccount {
  id              String           @id @default(uuid())
  code            String
  name            String
  type            String
  openingBalance  Float            @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  currentBalance  Float            @default(0)
  companyId       String
  paymentVouchers PaymentVoucher[]
  receiptVouchers ReceiptVoucher[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model ReceivableAccount {
  id              String           @id @default(uuid())
  code            String
  name            String
  openingBalance  Float            @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  currentBalance  Float            @default(0)
  companyId       String
  paymentVouchers PaymentVoucher[]
  receiptVouchers ReceiptVoucher[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model PayableAccount {
  id              String           @id @default(uuid())
  code            String
  name            String
  openingBalance  Float            @default(0)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  currentBalance  Float            @default(0)
  companyId       String
  paymentVouchers PaymentVoucher[]
  receiptVouchers ReceiptVoucher[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model ExpenseType {
  id           String        @id @default(uuid())
  name         String
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  companyId    String
  expenseCodes ExpenseCode[]
  company      Company       @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model ExpenseCode {
  id              String           @id @default(uuid())
  code            String
  name            String
  description     String?
  expenseTypeId   String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  companyId       String
  expenses        Expense[]
  expenseType     ExpenseType      @relation(fields: [expenseTypeId], references: [id])
  paymentVouchers PaymentVoucher[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([expenseTypeId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model RevenueCode {
  id              String           @id @default(uuid())
  code            String
  name            String
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  companyId       String
  paymentVouchers PaymentVoucher[]
  receiptVouchers ReceiptVoucher[]
  company         Company          @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Expense {
  id            String      @id @default(uuid())
  code          String
  date          DateTime
  description   String?
  expenseCodeId String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  companyId     String
  expenseCode   ExpenseCode @relation(fields: [expenseCodeId], references: [id])
  company       Company    @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([expenseCodeId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model SalesInvoice {
  id                  String              @id @default(uuid())
  code                String
  date                DateTime            @default(now())
  customerId          String?
  items               Json
  subtotal            Float               @default(0)
  discount            Float               @default(0)
  tax                 Float               @default(0)
  net                 Float               @default(0)
  paymentMethod       String
  paymentTargetType   String?
  paymentTargetId     String?
  notes               String?
  userId              String
  branchId            String?
  companyId           String
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  bankId              String?
  safeId              String?
  bankTransactionType BankTransactionType @default(POS)
  isSplitPayment      Boolean             @default(false)
  splitCashAmount     Float?
  splitBankAmount     Float?
  splitSafeId         String?
  splitBankId         String?
  bank                Bank?               @relation(fields: [bankId], references: [id])
  branch              Branch?             @relation(fields: [branchId], references: [id])
  customer            Customer?           @relation(fields: [customerId], references: [id])
  safe                Safe?               @relation(fields: [safeId], references: [id])
  user                User                @relation(fields: [userId], references: [id])
  company             Company             @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([customerId])
  @@index([userId])
  @@index([safeId])
  @@index([bankId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model PriceQuotation {
  id           String    @id @default(uuid())
  code         String
  date         DateTime  @default(now())
  expiryDate   DateTime?
  status       String    @default("draft")
  notes        String?
  items        Json
  totals       Json
  customerId   String?
  customerName String?
  userId       String
  branchId     String?
  companyId    String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  branch       Branch?   @relation(fields: [branchId], references: [id])
  customer     Customer? @relation(fields: [customerId], references: [id])
  user         User      @relation(fields: [userId], references: [id])
  company      Company   @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([customerId])
  @@index([userId])
  @@index([branchId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model SalesReturn {
  id                String    @id @default(uuid())
  code              String
  date              DateTime  @default(now())
  customerId        String?
  items             Json
  subtotal          Float     @default(0)
  discount          Float     @default(0)
  tax               Float     @default(0)
  net               Float     @default(0)
  paymentMethod     String
  paymentTargetType String?
  paymentTargetId   String?
  notes             String?
  userId            String
  branchId          String?
  companyId         String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  bankId            String?
  safeId            String?
  bank              Bank?     @relation(fields: [bankId], references: [id])
  branch            Branch?   @relation(fields: [branchId], references: [id])
  customer          Customer? @relation(fields: [customerId], references: [id])
  safe              Safe?     @relation(fields: [safeId], references: [id])
  user              User      @relation(fields: [userId], references: [id])
  company           Company   @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([customerId])
  @@index([userId])
  @@index([safeId])
  @@index([bankId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model PurchaseInvoice {
  id                String    @id @default(uuid())
  code              String
  date              DateTime  @default(now())
  supplierId        String?
  items             Json
  subtotal          Float     @default(0)
  discount          Float     @default(0)
  tax               Float     @default(0)
  net               Float     @default(0)
  paymentMethod     String
  paymentTargetType String?
  paymentTargetId   String?
  notes             String?
  userId            String
  branchId          String?
  companyId         String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  bankId            String?
  safeId            String?
  bank              Bank?     @relation(fields: [bankId], references: [id])
  branch            Branch?   @relation(fields: [branchId], references: [id])
  safe              Safe?     @relation(fields: [safeId], references: [id])
  supplier          Supplier? @relation(fields: [supplierId], references: [id])
  user              User      @relation(fields: [userId], references: [id])
  company           Company   @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([supplierId])
  @@index([userId])
  @@index([safeId])
  @@index([bankId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model PurchaseReturn {
  id                String    @id @default(uuid())
  code              String
  date              DateTime  @default(now())
  supplierId        String?
  items             Json
  subtotal          Float     @default(0)
  discount          Float     @default(0)
  tax               Float     @default(0)
  net               Float     @default(0)
  paymentMethod     String
  paymentTargetType String?
  paymentTargetId   String?
  notes             String?
  userId            String
  branchId          String?
  companyId         String
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  bankId            String?
  safeId            String?
  bank              Bank?     @relation(fields: [bankId], references: [id])
  branch            Branch?   @relation(fields: [branchId], references: [id])
  safe              Safe?     @relation(fields: [safeId], references: [id])
  supplier          Supplier? @relation(fields: [supplierId], references: [id])
  user              User      @relation(fields: [userId], references: [id])
  company           Company   @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([supplierId])
  @@index([userId])
  @@index([safeId])
  @@index([bankId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model PaymentVoucher {
  id                  String             @id @default(uuid())
  code                String
  date                DateTime           @default(now())
  entityType          String
  entityName          String
  amount              Float
  description         String?
  paymentMethod       String
  safeId              String?
  bankId              String?
  customerId          String?
  supplierId          String?
  currentAccountId    String?
  expenseCodeId       String?
  revenueCodeId       String?
  userId              String
  branchId            String?
  companyId           String
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  receivableAccountId String?
  payableAccountId    String?
  priceBeforeTax      Float?
  taxPrice            Float?
  bank                Bank?              @relation(fields: [bankId], references: [id])
  branch              Branch?            @relation(fields: [branchId], references: [id])
  currentAccount      CurrentAccount?    @relation(fields: [currentAccountId], references: [id])
  customer            Customer?          @relation(fields: [customerId], references: [id])
  expenseCode         ExpenseCode?       @relation(fields: [expenseCodeId], references: [id])
  revenueCode         RevenueCode?       @relation(fields: [revenueCodeId], references: [id])
  payableAccount      PayableAccount?    @relation(fields: [payableAccountId], references: [id])
  receivableAccount   ReceivableAccount? @relation(fields: [receivableAccountId], references: [id])
  safe                Safe?              @relation(fields: [safeId], references: [id])
  supplier            Supplier?          @relation(fields: [supplierId], references: [id])
  user                User               @relation(fields: [userId], references: [id])
  company             Company           @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([entityType])
  @@index([userId])
  @@index([receivableAccountId])
  @@index([payableAccountId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model ReceiptVoucher {
  id                  String             @id @default(uuid())
  code                String
  date                DateTime           @default(now())
  entityType          String
  entityName          String
  amount              Float
  description         String?
  paymentMethod       String
  safeId              String?
  bankId              String?
  customerId          String?
  supplierId          String?
  currentAccountId    String?
  revenueCodeId       String?
  userId              String
  branchId            String?
  companyId           String
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  receivableAccountId String?
  payableAccountId    String?
  bank                Bank?              @relation(fields: [bankId], references: [id])
  branch              Branch?            @relation(fields: [branchId], references: [id])
  currentAccount      CurrentAccount?    @relation(fields: [currentAccountId], references: [id])
  customer            Customer?          @relation(fields: [customerId], references: [id])
  revenueCode         RevenueCode?       @relation(fields: [revenueCodeId], references: [id])
  payableAccount      PayableAccount?    @relation(fields: [payableAccountId], references: [id])
  receivableAccount   ReceivableAccount? @relation(fields: [receivableAccountId], references: [id])
  safe                Safe?              @relation(fields: [safeId], references: [id])
  supplier            Supplier?          @relation(fields: [supplierId], references: [id])
  user                User               @relation(fields: [userId], references: [id])
  company             Company           @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([entityType])
  @@index([userId])
  @@index([receivableAccountId])
  @@index([payableAccountId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model InternalTransfer {
  id          String   @id @default(uuid())
  code        String
  date        DateTime @default(now())
  amount      Float
  description String?
  fromType    String
  toType      String
  fromSafeId  String?
  fromBankId  String?
  toSafeId    String?
  toBankId    String?
  userId      String
  branchId    String?
  companyId  String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  branch      Branch?  @relation(fields: [branchId], references: [id])
  fromBank    Bank?    @relation("FromBankTransfers", fields: [fromBankId], references: [id])
  fromSafe    Safe?    @relation("FromSafeTransfers", fields: [fromSafeId], references: [id])
  toBank      Bank?    @relation("ToBankTransfers", fields: [toBankId], references: [id])
  toSafe      Safe?    @relation("ToSafeTransfers", fields: [toSafeId], references: [id])
  user        User     @relation(fields: [userId], references: [id])
  company     Company  @relation(fields: [companyId], references: [id])

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([userId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model InventoryCount {
  id                 String               @id @default(uuid())
  code               String
  date               DateTime             @default(now())
  status             InventoryCountStatus @default(PENDING)
  notes              String?
  totalVarianceValue Float                @default(0)
  storeId            String
  userId             String
  branchId           String?
  companyId          String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  branch             Branch?              @relation(fields: [branchId], references: [id])
  store              Store                @relation(fields: [storeId], references: [id])
  user               User                 @relation(fields: [userId], references: [id])
  company            Company              @relation(fields: [companyId], references: [id])
  items              InventoryCountItem[]

  @@unique([code, companyId])
  @@index([code])
  @@index([date])
  @@index([status])
  @@index([storeId])
  @@index([userId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model InventoryCountItem {
  id               String         @id @default(uuid())
  systemStock      Float
  actualStock      Float
  difference       Float
  cost             Float
  inventoryCountId String
  itemId           String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  inventoryCount   InventoryCount @relation(fields: [inventoryCountId], references: [id], onDelete: Cascade)
  item             Item           @relation(fields: [itemId], references: [id])

  @@index([inventoryCountId])
  @@index([itemId])
}

model AuditLog {
  id         String   @id @default(uuid())
  timestamp  DateTime @default(now())
  userId     String
  branchId   String?
  action     String // create, update, delete, approve, reject, login, logout
  targetType String // e.g., "store_receipt_voucher", "sales_invoice"
  targetId   String?
  details    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  companyId  String
  company    Company  @relation(fields: [companyId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
  branch     Branch?  @relation(fields: [branchId], references: [id])

  @@index([timestamp])
  @@index([userId])
  @@index([branchId])
  @@index([action])
  @@index([targetType])
  @@index([targetId])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

enum SessionStatus {
  ACTIVE
  INACTIVE
}

enum OtpType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
}

enum ItemType {
  STOCKED
  SERVICE
}

enum InventoryCountStatus {
  PENDING
  POSTED
}

enum BankTransactionType {
  POS
  TRANSFER
}

enum StoreTransferStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum FiscalYearStatus {
  OPEN
  CLOSED
}

enum SubscriptionPlanType {
  BASIC
  GROWTH
  BUSINESS
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  CANCELLED
  TRIAL
}

model FiscalYear {
  id               String           @id @default(uuid())
  name             String
  startDate        DateTime
  endDate          DateTime
  status           FiscalYearStatus @default(OPEN)
  retainedEarnings Float?
  companyId        String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  company          Company          @relation(fields: [companyId], references: [id])

  @@unique([name, companyId])
  @@index([startDate])
  @@index([endDate])
  @@index([status])
  @@index([companyId])
  @@index([id, companyId])
  @@unique([id, companyId])
}

model Subscription {
  id        String               @id @default(uuid())
  planType  SubscriptionPlanType
  status    SubscriptionStatus   @default(ACTIVE)
  startDate DateTime             @default(now())
  endDate   DateTime?
  companyId String               @unique
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  company   Company              @relation(fields: [companyId], references: [id])

  @@index([companyId])
  @@index([status])
  @@index([planType])
}
